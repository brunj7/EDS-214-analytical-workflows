<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working on a remote server – EDS214 - Analytical Workflows and Scientific Reproducibility</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">EDS214 - Analytical Workflows and Scientific Reproducibility</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-daily-materials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Daily Materials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-daily-materials">    
        <li>
    <a class="dropdown-item" href="./day_1.html">
 <span class="dropdown-text">Day 1: Reproducible &amp; collaborative workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day_2.html">
 <span class="dropdown-text">Day 2: Working on a remote server</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day_3.html">
 <span class="dropdown-text">Day 3: Getting data in a programmatic way</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day_4.html">
 <span class="dropdown-text">Day 4: Being reproducible: Tools and Practices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day_5.html">
 <span class="dropdown-text">Day 5: Reproducible for all</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./group_project.html">
 <span class="dropdown-text">Group project</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/brunj7/EDS-214-analytical-workflows" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#why-working-on-a-remote-machine" id="toc-why-working-on-a-remote-machine" class="nav-link" data-scroll-target="#why-working-on-a-remote-machine">Why working on a remote machine?</a></li>
  <li><a href="#introduction-to-unix-and-its-siblings" id="toc-introduction-to-unix-and-its-siblings" class="nav-link" data-scroll-target="#introduction-to-unix-and-its-siblings">Introduction to UNIX and its siblings</a>
  <ul class="collapse">
  <li><a href="#various-unices" id="toc-various-unices" class="nav-link" data-scroll-target="#various-unices">Various Unices</a></li>
  <li><a href="#some-unix-hallmarks" id="toc-some-unix-hallmarks" class="nav-link" data-scroll-target="#some-unix-hallmarks">Some Unix hallmarks</a></li>
  </ul></li>
  <li><a href="#connecting-via-ide---posit-workbench" id="toc-connecting-via-ide---posit-workbench" class="nav-link" data-scroll-target="#connecting-via-ide---posit-workbench">Connecting via IDE - Posit Workbench</a></li>
  <li><a href="#connecting-to-meds-analytical-server" id="toc-connecting-to-meds-analytical-server" class="nav-link" data-scroll-target="#connecting-to-meds-analytical-server">Connecting to MEDS Analytical Server</a>
  <ul class="collapse">
  <li><a href="#file-structure" id="toc-file-structure" class="nav-link" data-scroll-target="#file-structure">File structure</a></li>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages">R packages</a></li>
  </ul></li>
  <li><a href="#the-command-line-interface-cli" id="toc-the-command-line-interface-cli" class="nav-link" data-scroll-target="#the-command-line-interface-cli">The Command Line Interface (CLI)</a>
  <ul class="collapse">
  <li><a href="#why-the-cli-is-worth-learning" id="toc-why-the-cli-is-worth-learning" class="nav-link" data-scroll-target="#why-the-cli-is-worth-learning">Why the CLI is worth learning</a></li>
  <li><a href="#a-little-bit-of-terminology" id="toc-a-little-bit-of-terminology" class="nav-link" data-scroll-target="#a-little-bit-of-terminology">A little bit of terminology</a></li>
  <li><a href="#the-terminal-from-rstudio" id="toc-the-terminal-from-rstudio" class="nav-link" data-scroll-target="#the-terminal-from-rstudio">The Terminal from RStudio</a></li>
  <li><a href="#permissions" id="toc-permissions" class="nav-link" data-scroll-target="#permissions">Permissions</a></li>
  </ul></li>
  <li><a href="#general-command-syntax" id="toc-general-command-syntax" class="nav-link" data-scroll-target="#general-command-syntax">General command syntax</a></li>
  <li><a href="#getting-things-done" id="toc-getting-things-done" class="nav-link" data-scroll-target="#getting-things-done">Getting things done</a>
  <ul class="collapse">
  <li><a href="#some-useful-special-commands-using-the-control-key" id="toc-some-useful-special-commands-using-the-control-key" class="nav-link" data-scroll-target="#some-useful-special-commands-using-the-control-key">Some useful, special commands using the Control key</a></li>
  <li><a href="#process-management" id="toc-process-management" class="nav-link" data-scroll-target="#process-management">Process management</a></li>
  <li><a href="#what-about-space" id="toc-what-about-space" class="nav-link" data-scroll-target="#what-about-space">What about “space”</a></li>
  <li><a href="#existential-questions" id="toc-existential-questions" class="nav-link" data-scroll-target="#existential-questions">Existential questions</a></li>
  <li><a href="#history" id="toc-history" class="nav-link" data-scroll-target="#history">History</a></li>
  </ul></li>
  <li><a href="#a-sampling-of-simple-commands-for-dealing-with-files" id="toc-a-sampling-of-simple-commands-for-dealing-with-files" class="nav-link" data-scroll-target="#a-sampling-of-simple-commands-for-dealing-with-files">A sampling of simple commands for dealing with files</a></li>
  <li><a href="#get-into-the-flow-with-pipes" id="toc-get-into-the-flow-with-pipes" class="nav-link" data-scroll-target="#get-into-the-flow-with-pipes">Get into the flow, with pipes</a></li>
  <li><a href="#cli-practice" id="toc-cli-practice" class="nav-link" data-scroll-target="#cli-practice"><strong>CLI Practice</strong></a></li>
  <li><a href="#bonuses" id="toc-bonuses" class="nav-link" data-scroll-target="#bonuses">Bonuses</a>
  <ul class="collapse">
  <li><a href="#vim-text-editor" id="toc-vim-text-editor" class="nav-link" data-scroll-target="#vim-text-editor">vim text editor</a></li>
  </ul></li>
  <li><a href="#advanced-cli" id="toc-advanced-cli" class="nav-link" data-scroll-target="#advanced-cli">Advanced CLI</a></li>
  <li><a href="#aknowledgements" id="toc-aknowledgements" class="nav-link" data-scroll-target="#aknowledgements">Aknowledgements</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working on a remote server</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/cern-server-small.jpg" class="img-fluid figure-img" style="width:110.0%"></p>
<figcaption>CERN computing center</figcaption>
</figure>
</div>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>In this lesson, you will learn:</p>
<ul>
<li>How to connect to a remote server</li>
<li>Get familiar with RStudio server</li>
<li>Get an introduction to the command line (CLI) &amp; bash</li>
</ul>
</section>
<section id="why-working-on-a-remote-machine" class="level2">
<h2 class="anchored" data-anchor-id="why-working-on-a-remote-machine">Why working on a remote machine?</h2>
<p>Often the main motivation is to <strong>scale your analysis beyond what a personal computer can handle</strong>. R being pretty memory intensive, moving to a server often provides you more RAM and thus allows to load larger data in R without the need of slicing your data into chunks. But there are also other advantages, here are the main for scientist:</p>
<ul>
<li><strong>Power</strong>: More <em>CPUs/Cores</em> (24/32/48), More RAM (256/384GB)</li>
<li><strong>Capacity</strong>: More <em>disk space</em> and generally <em>faster storage</em> (in highly optimized RAID arrays)</li>
<li><strong>Security</strong>: Data are spread across <em>multiple drives</em> and have nightly <em>backups</em></li>
<li><strong>Collaboration</strong>: <em>shared folders</em> for code, data, and other materials; same <em>software versions</em></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><em>=&gt; The operating system is more likely going to be Linux!!</em></strong></p>
<p>More on this in a few minutes</p>
</div>
</div>
</section>
<section id="introduction-to-unix-and-its-siblings" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-unix-and-its-siblings">Introduction to UNIX and its siblings</h2>
<dl>
<dt>UNIX</dt>
<dd>
Originally developed at AT&amp;T / <a href="https://en.wikipedia.org/wiki/Bell_Labs">Bell Labs</a> circa 1970. Has experienced a <a href="https://upload.wikimedia.org/wikipedia/commons/7/77/Unix_history-simple.svg">long, multi-branched evolutionary path</a>
</dd>
<dt>POSIX (Portable Operating System Interface)</dt>
<dd>
a set of specifications of what an OS needs to qualify as “a Unix”, to enhance interoperability among all the “Unix” variants
</dd>
</dl>
<section id="various-unices" class="level3">
<h3 class="anchored" data-anchor-id="various-unices">Various Unices</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/unix-history-simple.png" class="img-fluid figure-img"></p>
<figcaption>The unix family tree</figcaption>
</figure>
</div>
<ul>
<li><dl>
<dt>Linux (Linus Torvalds, 1991)</dt>
<dd>
is <em>not</em> fully POSIX-compliant, but certainly can be regarded as <a href="http://en.wikipedia.org/wiki/Unix-like">functionally Unix</a> <br> Some popular Linux distributions include Debian, Fedora Linux, Arch Linux, and Ubuntu. There are also commercial distributions such as Red Hat Enterprise Linux and SUSE Linux Enterprise. Android is actually Linux-based!
</dd>
</dl></li>
<li><dl>
<dt>OS X</dt>
<dd>
<a href="http://unix.stackexchange.com/questions/1489/is-mac-os-x-unix">is a Unix</a>!
</dd>
</dl></li>
</ul>
</section>
<section id="some-unix-hallmarks" class="level3">
<h3 class="anchored" data-anchor-id="some-unix-hallmarks">Some Unix hallmarks</h3>
<ul>
<li>Supports multi-users, multi-processes</li>
<li>Highly modular: many small tools that do one thing well, and can be combined</li>
<li>Culture of text files and streams</li>
<li>Primary OS on HPC (<strong>High Performance Computing</strong> Systems)</li>
<li>Main OS on which Internet was built</li>
</ul>
<hr>
</section>
</section>
<section id="connecting-via-ide---posit-workbench" class="level2">
<h2 class="anchored" data-anchor-id="connecting-via-ide---posit-workbench">Connecting via IDE - Posit Workbench</h2>
<p>From an user perspective, <em>Posit Workbench is your familiar RStudio interface in your web browser</em>. The big difference however is that with RStudio Server the computation will be running on the remote machine instead of your local personal computer. This also means that <strong>the files you are seeing through the RStudio Server interface are located on the remote machine. And this also include your R packages!!!</strong> This remote file management is the main change you will have to adopt in your workflow.</p>
<p>To help with remote files management, the RStudio Server interface as few additional features that we will be discussing in the following sections.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/rstudio-server-ide.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="connecting-to-meds-analytical-server" class="level2">
<h2 class="anchored" data-anchor-id="connecting-to-meds-analytical-server">Connecting to MEDS Analytical Server</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reference
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://bren.zendesk.com/hc/en-us/articles/8727865050900-MEDS-Computational-Server-Guide">MEDS computational servers guide</a></p>
</div>
</div>
<ol type="1">
<li><p>Got to: <a href="https://workbench-1.bren.ucsb.edu" class="uri">https://workbench-1.bren.ucsb.edu</a></p></li>
<li><p>Enter your credentials</p></li>
<li><p>You are in!</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/rstudio-server_login.png" class="img-fluid figure-img" width="1544"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Click on the <code>New Session</code> button. You can see that you are able to start both an R (Studio) and jupyter notebook session. Let’s take a few minutes to experiment with the different options.</li>
</ol>
<p>For this session, we are going to select the <code>RStudio</code> option and hit <code>Start Session</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/rstudio-server_session.png" class="img-fluid figure-img" width="591"></p>
</figure>
</div>
</div>
</div>
<p><strong>You should now see a very familiar interface :) Except it is running on the server with a lot of resources at your fingertips!!</strong></p>
<section id="file-structure" class="level3">
<h3 class="anchored" data-anchor-id="file-structure">File structure</h3>
<p>Let’s explore explore a little bit the file structure on the server. By default on a Linux server, you are located in the <code>home</code> folder. This folder is only accessible to you and it is where you can store your personal files on a server. You should see 2 folders: <code>R</code> and <code>H</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/rstudio-server_file-structure.png" class="img-fluid figure-img" width="779"></p>
</figure>
</div>
</div>
</div>
<p>The <code>R</code> folder is where your local R packages will be installed, you can ignore it. The <code>H</code> is your H drive that the Bren School is offering to all its students. If you click on it you should see any files you have uploaded there.</p>
<p>Let us make a folder named <code>github</code> by click on the <code>New Folder</code> button at the top of the tab. We will use this folder (also named <code>directory</code> in linux/unix terms) to clone any GitHub repository.</p>
</section>
<section id="r-packages" class="level3">
<h3 class="anchored" data-anchor-id="r-packages">R packages</h3>
<p>If we go to the <code>Packages</code> tab, we can see a long list of packages that have already be installed by our system administrator (Brad). Those packages have been installed server wide, meaning that all the users have access to them.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/rstudio-server_packages.png" class="img-fluid figure-img" width="779"></p>
</figure>
</div>
</div>
</div>
<p>A user can also installed her/his own packages. Let’s try to install the <code>remote</code> package that lets you install R packages directly from GitHub: <code>install.packages("remotes")</code>. Once done, note a new section that appeared on the Packages tab named <code>User Library</code>. Each of us have now its own copy of the package installed (in this <code>R</code> folder we were talking about a few minutes ago).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/rstudio-server_packages-user.png" class="img-fluid figure-img" width="777"></p>
</figure>
</div>
</div>
</div>
<p>A few notes:</p>
<ul>
<li>In this example we will have made a better choice to have the <code>remotes</code> package installed once at the system level</li>
<li>Some R packages depend on external libraries that need to be installed on the server. Those libraries will have to be installed by the system administrator first before you can install the R package</li>
<li>Installing an R package on a linux machine generally requires compilation of the code and will thus take more time to install than when you install it from pre-compiled binaries</li>
</ul>
<p><strong>Look now inside you <code>R</code> folder!!</strong></p>
<hr>
</section>
</section>
<section id="the-command-line-interface-cli" class="level2">
<h2 class="anchored" data-anchor-id="the-command-line-interface-cli">The Command Line Interface (CLI)</h2>
<p>The CLI provides a direct way to interact with the Operating System, by typing in commands.</p>
<section id="why-the-cli-is-worth-learning" class="level3">
<h3 class="anchored" data-anchor-id="why-the-cli-is-worth-learning">Why the CLI is worth learning</h3>
<ul>
<li>Might be the only interface you have to a High Performance Computer (HPC)</li>
<li>Command statements can be reused easily and saved as scripts</li>
<li>Easier automation and text files manipulation</li>
</ul>
</section>
<section id="a-little-bit-of-terminology" class="level3">
<h3 class="anchored" data-anchor-id="a-little-bit-of-terminology">A little bit of terminology</h3>
<ul>
<li><code>Command Line Interface (CLI)</code>: This is a user interface that lets you interact with a computer. It is a legacy from the early days of computers. Now a days computers have graphical user interfaces instead (MacOSX, Windows, Linux, …)</li>
<li><code>Terminal</code>: It is a an application that lets you run a command line interface. It used to be a physical machine connected to a mainframe computer</li>
<li><code>Shell</code>: It is the program that runs the command line. There are many different shells, the most common being <code>bash</code> (Bourne Again SHell) which is installed by default in many Linux distributions</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The pitch
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Not convinced? Check this out: <a href="https://eds-214.github.io/eds214-handson-cli/cli-pitch.html">the CLI pitch</a></strong></p>
</div>
</div>
</section>
<section id="the-terminal-from-rstudio" class="level3">
<h3 class="anchored" data-anchor-id="the-terminal-from-rstudio">The Terminal from RStudio</h3>
<p>You can access the command line directly from RStudio by using the <code>Terminal</code> tab next to your R console.</p>
<p><img src="img/rstudio-terminal.png" class="img-fluid"> ### Navigating and managing files/directories in *NIX</p>
<p><img src="img/unix_filetree.gif" class="img-fluid"></p>
<ul>
<li><code>pwd</code>: Know where you are</li>
<li><code>ls</code>: List the content of the directory</li>
<li><code>cd</code>: Go inside a directory</li>
</ul>
<p>Some pseudo directory names. Wherever you are:</p>
<ul>
<li><code>~</code> : Home directory</li>
<li><code>.</code> : Here (current directory)</li>
<li><code>..</code>: Up one level (upper directory)</li>
</ul>
<p>Let’s put this into action:</p>
<ul>
<li>go to my “Home” directory: <code>cd ~</code></li>
<li>go up one directory level: <code>cd ..</code></li>
<li>list the content: <code>ls</code></li>
<li>list the content showing hidden files: <code>ls -a</code> note that <code>-a</code> is referred as an option (modifies the command)</li>
</ul>
<p>More files/directories manipulations:</p>
<ul>
<li><code>mkdir</code>: Create a directory</li>
<li><code>cp</code>: Copy a file</li>
<li><code>mv</code>: Move a file <strong>it is also how you rename a file!</strong></li>
<li><code>rm</code> / <code>rmdir</code>: Remove a file / directory <strong>use those carefully, there is no return / Trash!!</strong></li>
</ul>
<p><strong>Note: typing is not your thing? the <code>&lt;tab&gt;</code> key is your friend!</strong> One hit it will auto-complete the file/directory/path name for you. If there are many options, hit it twice to see the options.</p>
</section>
<section id="permissions" class="level3">
<h3 class="anchored" data-anchor-id="permissions">Permissions</h3>
<p>All files have permissions and ownership.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/UnixFileLongFormat.png" class="img-fluid figure-img"></p>
<figcaption>File permissions</figcaption>
</figure>
</div>
<ul>
<li>List files showing ownership and permissions: <code>ls -l</code></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brun@workbench-1:/courses/EDS214$</span> ls <span class="at">-l</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">total</span> 16</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x+</span> 3 brun      esmdomainusers 4096 Aug 20 04:49 data</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x+</span> 2 katherine esmdomainusers 4096 Aug 18 18:32 example    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can change those permissions:</p>
<ul>
<li>Change permissions: <code>chmod</code></li>
<li>Change ownership: <code>chown</code></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Clear contents in terminal window: <code>clear</code></p>
</div>
</div>
</section>
</section>
<section id="general-command-syntax" class="level2">
<h2 class="anchored" data-anchor-id="general-command-syntax">General command syntax</h2>
<ul>
<li><code>command [options] [arguments]</code></li>
</ul>
<p>where <code>command</code> must be an <em>executable</em> file on your <code>PATH</code> * <code>echo $PATH</code></p>
<p>and <code>options</code> can usually take two forms * short form: <code>-a</code> * long form: <code>--all</code></p>
<p>You can combine the options:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-ltrh</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What do these options do?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>hit <code>spacebar</code> to get to the next page of the manual hit <code>q</code> to exit the help</p>
</div>
</div>
</section>
<section id="getting-things-done" class="level2">
<h2 class="anchored" data-anchor-id="getting-things-done">Getting things done</h2>
<section id="some-useful-special-commands-using-the-control-key" class="level3">
<h3 class="anchored" data-anchor-id="some-useful-special-commands-using-the-control-key">Some useful, special commands using the Control key</h3>
<ul>
<li>Cancel (abort) a command: <code>Ctrl-c</code> Note: very different than Windows!!</li>
<li>Stop (suspend) a command: <code>Ctrl-z</code></li>
<li><code>Ctrl-z</code> can be used to suspend, then background a process</li>
</ul>
</section>
<section id="process-management" class="level3">
<h3 class="anchored" data-anchor-id="process-management">Process management</h3>
<ul>
<li>Like Windows Task Manager, OSX Activity Monitor</li>
<li><strong><code>top</code></strong>, <code>ps</code>, <code>jobs</code> (hit <code>q</code> to get out!)</li>
<li><code>kill</code> to delete an unwanted job or process</li>
<li>Foreground and background: <code>&amp;</code></li>
</ul>
</section>
<section id="what-about-space" class="level3">
<h3 class="anchored" data-anchor-id="what-about-space">What about “space”</h3>
<ul>
<li>How much storage is available on this system? <code>df -h</code></li>
<li>How much storage am “I” using overall? <code>du -hs &lt;folder&gt;</code></li>
<li>How much storage am “I” using, by sub directory? <code>du -h &lt;folder&gt;</code></li>
<li>How much RAM is used? <code>free -h</code></li>
</ul>
</section>
<section id="existential-questions" class="level3">
<h3 class="anchored" data-anchor-id="existential-questions">Existential questions</h3>
<ul>
<li>What is your username? <code>whoami</code></li>
<li>What is today’s date? <code>date</code></li>
<li>Where are the programs you are using? <code>whereis R</code> also try <code>which -a python</code></li>
<li>What is the kernel version of your OS: <code>uname -a</code></li>
<li>How long since last reboot: <code>uptime</code></li>
<li>Which shell are you using? <code>echo $0</code></li>
</ul>
</section>
<section id="history" class="level3">
<h3 class="anchored" data-anchor-id="history">History</h3>
<ul>
<li>See your command history: <code>history</code></li>
<li>Re-run last command: <code>!!</code></li>
<li>Re-run 32th command: <code>!32</code></li>
<li>Re-run 5th from last command: <code>!-5</code></li>
<li>Re-run last command that started with ‘c’: <code>!c</code></li>
</ul>
</section>
</section>
<section id="a-sampling-of-simple-commands-for-dealing-with-files" class="level2">
<h2 class="anchored" data-anchor-id="a-sampling-of-simple-commands-for-dealing-with-files">A sampling of simple commands for dealing with files</h2>
<ul>
<li><code>wc</code> count lines, words, and/or characters</li>
<li><code>diff</code> compare two files for differences</li>
<li><code>sort</code> sort lines in a file</li>
<li><code>uniq</code> report or filter out repeated lines in a file</li>
</ul>
</section>
<section id="get-into-the-flow-with-pipes" class="level2">
<h2 class="anchored" data-anchor-id="get-into-the-flow-with-pipes">Get into the flow, with pipes</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/pipe_split.png" title="http://www.ucblueash.edu/thomas/Intro_Unix_Text/Images/pipe_split.png" class="img-fluid figure-img"></p>
<figcaption><code>stdin</code>, <code>stdout</code>, <code>stderr</code></figcaption>
</figure>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="pp">*</span>.TXT </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="pp">*</span>.TXT <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{callout-tip}">
<ul>
<li>note use of <code>*</code> as character wildcard for zero or more matches (same in Mac and Windows)</li>
<li><code>?</code> matches single character;</li>
</ul>
</div>
<p>Here the <code>wc -l</code> command, which counts the number of lines in files, is given file names on the command line, so it counts the lines in those files. It writes its output to stdout. <code>sort -n</code> sorts lines in files. It was given no files to sort, so it sorts whatever lines come in via stdin. By piping these together (i.e., by hooking <code>wc</code>’s stdout to <code>sort</code>’s stdin using the pipe operator), the output from <code>wc -l</code> is thereby sorted.</p>
<p>There are various operators for redirecting where stdin comes from and where stdout and stderr go:</p>
<ul>
<li><code>&lt; file</code>: read stdin from file</li>
<li><code>&gt; file</code>: write stdout to file</li>
<li><code>2&gt; file</code>: write stderr to file</li>
<li><code>&gt;&amp; file</code>: write both stdout and stderr to file</li>
<li><code>&gt;&gt; file</code>: append stdout to file</li>
</ul>
<p>Let’s write the above result to a file:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="pp">*</span>.TXT <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span> <span class="op">&gt;</span> csvcount.log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Caution: except for <code>&gt;&gt;</code>, all forms of <code>&gt;</code> are destructive: Bash overwrites any existing file with an empty file before the program is run.</p>
<p>Want to get rid of output you don’t want to see? Use the Unix black hole: <code>&gt;&amp; /dev/null</code>. (This is a cultural meme, you’ll see it on T-shirts and license plates.)</p>
<p>The above are the main redirections, but there are others.</p>
<p><strong>To end a session, simply type <code>exit</code> or <code>logout</code> into the command line</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setting git on workbench-1 (if not yet done)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>At the <strong>Terminal</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.name <span class="st">"Jane Doe"</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.email janedoe@example.com</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> credential.helper <span class="st">'cache --timeout=10000000'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="setting-github-token-on-workbench-1" class="level3">
<h3 class="anchored" data-anchor-id="setting-github-token-on-workbench-1">Setting GitHub token on workbench-1</h3>
<p>At the <strong>R Console</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On your laptop</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_github_token</span>() <span class="co"># This should open a web browser on GitHub</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On workbench-1 </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>gitcreds<span class="sc">::</span><span class="fu">gitcreds_set</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">git_sitrep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="cli-practice" class="level2">
<h2 class="anchored" data-anchor-id="cli-practice"><a href="https://github.com/EDS-214/eds214-handson-cli" target="_blank"><strong>CLI Practice</strong></a></h2>
<hr>
</section>
<section id="bonuses" class="level2">
<h2 class="anchored" data-anchor-id="bonuses">Bonuses</h2>
<section id="vim-text-editor" class="level3">
<h3 class="anchored" data-anchor-id="vim-text-editor">vim text editor</h3>
<p>This section is optional depending of our progress and interest. Vim is still the default text editor on many Linux distribution and it is good to know about its basics.</p>
<p><a href="vim.html">Vim</a></p>
</section>
</section>
<section id="advanced-cli" class="level2">
<h2 class="anchored" data-anchor-id="advanced-cli">Advanced CLI</h2>
<p>Want to know more cool tools your can use: <a href="day2-cli_advanced.html"><strong>CLI Adanved</strong></a></p>
</section>
<section id="aknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="aknowledgements">Aknowledgements</h2>
<p>This section reuses materials from <a href="https://learning.nceas.ucsb.edu/">NCEAS Open Science for Synthesis (OSS)</a> intensive summer schools and other training. Contributions to this content have been made by Mark Schildhauer, Matt Jones, Jim Regetz and many others; and from EDS-213 <a href="https://github.com/UCSB-Library-Research-Data-Services/bren-meds213-class-data/blob/main/week5/bash-essentials.md">10 bash essentials</a> developed by Greg Janée</p>


</section>

</main> <!-- /main -->
<br>
<hr>
<p align="center">
<a href="https://bren.ucsb.edu/"><img src="img/bren-logo_color.png" alt="Bren School logo" style="width:350px;"></a>
</p>

<p align="center">
  The original parts of this work are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>

<p align="center">
  This website was made with <u><a href="https://quarto.org">quarto by Posit</a></u>.
</p>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/brunj7\.github\.io\/EDS-214-analytical-workflows\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>